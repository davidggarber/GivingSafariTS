<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"></meta>
    <script> var exports = {}; </script>
    <script src="../js/kit.js"></script>
    <script>
      const boiler = {
        'safari': '24',
        'title': 'Blokus',
        'author': 'David Garber',
        'copyright': '2024',
        'orientation': 'portrait',
        'textInput': true,
        'abilities': {
          'dragDrop': true,
        },
        'reactiveBuilder': true,
        'builderLookup': {
        },
        'postBuild': buildSvgs,
      };

      // Tile shapes, which will never rotate.
      //   1-9 and dot indicate visible contents of each cell.
      //   Spaces fill out bounding rectangle.
      var tiles = {
        a: {board:false, x:1, y:0, values:['5']},
        b: {board:false, x:3, y:0, values:['23']},
        c: {board:false, x:6, y:0, values:['5268']},
        d: {board:false, x:13, y:0, values:['714',
                                            '  2',
                                            '  6']},
        e: {board:false, x:11, y:1, values:['8 ',
                                            '39',
                                            '9 ']},
        f: {board:false, x:0, y:2, values:['6',
                                           '2',
                                           '4']},
        g: {board:false, x:3, y:2, values:['2 ',
                                           '71']},
        h: {board:false, x:6, y:2, values:['27',
                                           '4 ',
                                           '6 ']},
        i: {board:false, x:9, y:3, values:['  5',
                                           '471',
                                           '  9']},
        j: {board:false, x:13, y:4, values:['14 ',
                                            ' 28']},
        k: {board:false, x:2, y:5, values:[' 3 ',
                                           '475',
                                           ' 1 ']},
        l: {board:false, x:11, y:5, values:['5 ',
                                            '9 ',
                                            '36',
                                            ' 7']},
        m: {board:false, x:7, y:6, values:[' 9',
                                           '71',
                                           ' 4',
                                           ' 6']},
        n: {board:false, x:9, y:7, values:[' 3 ',
                                           '59 ',
                                           ' 12']},
        o: {board:false, x:14, y:7, values:['8 ',
                                            '35',
                                            '71']},
        p: {board:false, x:0, y:9, values:['52896']},
        q: {board:true, x:6, y:0, values:['..',
                                          '3 ',
                                          '78']},
        r: {board:true, x:0, y:2, values:[' 96',
                                          '.1 ',
                                          '.  ']},
        s: {board:true, x:4, y:4, values:['48',
                                          '63']},
        t: {board:true, x:7, y:6, values:['548.',
                                          '   .']},
        u: {board:true, x:4, y:8, values:[' 89',
                                          ' 3 ',
                                          '.. ']},
      }

      // Extraction coordinates, where active board is 1-9, 
      // while 0 and 10 are border areas
      var extractPairs = [
        [{x:3,y:2},{x:4,y:2}],
        [{x:6,y:3},{x:7,y:3}],
        [{x:2,y:5},{x:3,y:5}],
        [{x:7,y:5},{x:8,y:5}],
        [{x:2,y:7},{x:2,y:8}],
        [{x:7,y:8},{x:7,y:9}],
      ];

      boiler['builderLookup'] =
      {
        tiles: tiles,
        extractLen: extractPairs.length,
      };

      function buildSvgs() {
        var svg_xmlns = 'http://www.w3.org/2000/svg';
        var board = document.getElementById('board');
        var extras = document.getElementById('extras');
        for (var id of Object.keys(tiles)) {
          var g = document.createElementNS(svg_xmlns, 'g');
          g.classList.add('tile');
          g.id = id;
          var tile = tiles[id];
          g.style.transform = 'translate(' + (tile.x * 40) + 'px,' + (tile.y * 40) + 'px)';
          for (var y = 0; y < tile.values.length; y++) {
            for (var x = 0; x < tile.values[y].length; x++) {
              var ch = tile.values[y][x];
              if (ch != ' ') {
                var rect = document.createElementNS(svg_xmlns, 'rect');
                rect.setAttributeNS('', 'x', x * 40);
                rect.setAttributeNS('', 'y', y * 40);
                rect.setAttributeNS('', 'width', 39);
                rect.setAttributeNS('', 'height', 39);
                g.appendChild(rect);
                var highlight = document.createElementNS(svg_xmlns, 'path');
                highlight.classList.add('highlight');
                var m = 'M' + (x * 40) + ',' + (y * 40 + 39);
                highlight.setAttributeNS('', 'd', m + ' v-39 h39');
                g.appendChild(highlight);
                var t = document.createElementNS(svg_xmlns, 'text');
                t.setAttributeNS('', 'x', x * 40 + 20);  // TODO: center
                t.setAttributeNS('', 'y', y * 40 + 24);                
                t.innerHTML = ch;
                g.appendChild(t);
              }
            }
          }
          if (tile.board) {
            board.appendChild(g);
          }
          else {
            extras.appendChild(g);
          }
        }
      }

    </script>
    <style>
      #flavor {
        position: absolute;
        left: 0px;
        top: 0.25in;
        width: 2.25in;
      }
      #extraction .pair {
        display: inline-block;
        margin: 0px;
      }
      #extraction .letter-cell {
        display: block;
        text-align: center;
        margin: 3px;
        font-size: 18pt;
      }
      #extraction .sum {
        display: block;
        text-align: center;
        font-size: 8pt;
      }
      #svg-area {
        position: absolute;
        top: 0px;
        right: 40px;
      }
      #board {
        transform:translate(160px,0px);
      }
      #extras {
        transform:translate(0px,460px);
      }

      .tile path {
        stroke-width: 1px;
        fill: none;
      }
      .tile text {
        text-anchor: middle;
      }

      #extras .tile rect {
        fill: #DEBDFF;
        stroke: #c7aae5;
      }
      #extras .tile .highlight {
        stroke: #e4caff;
      }


      .block-z {
        background-color: #D9D9D9;
        border-color: #D9D9D9
      }
      .block-q {
        background-color: #ED7D31;
        border-color: #ee8a45 #d5702c #d5702c #ee8a45;
      }
      .block-r {
        background-color: #FFC000;
        border-color: #ffc619 #e5ac00 #e5ac00 #ffc619;
      }
      .block-s {
        background-color: #F141C7;
        border-color: #f254cc #d83ab3 #d83ab3 #f254cc;
      }
      .block-t {
        background-color: #92D050;
        border-color: #9cd461 #83bb48 #83bb48 #9cd461;
      }
      .block-u {
        background-color: #5B9BD5;
        border-color: #6ba5d9 #518bbf #518bbf #6ba5d9;
      }
    </style>
  </head>
  <body id="Blokus">
    <div id="pageBody">
      <div id="flavor">
        <p>
          Someone seems to have been taking some liberties with their Blokus game. 
          I think they started out doodling on the board, and then one thing led to another. 
          They’re down to just one full set of the 21 unique pieces, and these have numbers written all over them. 
          The last straw is that they’ve glued 5 of the pieces to the board!
        </p>
        <p>
          Please pack these back together. 
          It looks like they’ll just barely fit into a classic Sudoku shape!
        </p>
        <div id="extraction">
          <for range="i" until="extractLen">
            <div class="pair" id="extraction-{i}">
              <span class="extract-letter"><letter id="ext-letter-{i}"></letter></span>
              <span class="sum" id="ext-sum-{i}">
                <span class="addend" id="ext-sum-{i}-0">&nbsp;</span>+<span class="addend" id="ext-sum-{i}-1">&nbsp;</span>
              </span>
            </div>
          </for>  
        </div>
      </div>

      <svg id="svg-area" width="600" height="880">
        <g id="board">

        </g>
        <g id="extras">

        </g>
      </svg>
      <p style="text-align: center; font-style: italic;">No rotations needed</p>

    </div>
  </body>
</html>
