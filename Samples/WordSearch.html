<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"></meta>
    <script> var exports = {}; </script>
    <script src="../js/kit.js"></script>
    <script>
      const boiler = {
        'safari': 'Sample',
        'title': 'Word Search',
        'author': 'David Garber',
        'copyright': '2023',
        'type': 'Word',
        'abilities': {
          'wordSearch': true
        }
      };

      var crossword;
      var container;

      function init() {
        crossword = document.getElementById('crossword');
        container = document.getElementById('word-select-container');

        // Copy the crossword template before running the exploding the puzzle during boilerplate initialization
        boilerplate(boiler);

        attr2Input('data-max-points');
        attr2Input('data-hover-range');
        attr2Input('data-angle-constraints');
        attr2Input('data-show-open-drag');
        attr2Input('data-can-cross-self');

        document.getElementById('toggle-word-select-container').checked = container.classList.contains('word-select-container');
      }

      function update() {
        input2Attr('data-max-points');
        input2Attr('data-hover-range');
        input2Attr('data-angle-constraints');
        input2Attr('data-show-open-drag');
        input2Attr('data-can-cross-self');

        if (document.getElementById('toggle-word-select-container').checked) {
          container.classList.add('word-select-container');
        }
        else {
          container.classList.remove('word-select-container');
        }

        showHtml();
      }

      function showHtml() {
        var svgTag = crossword.outerHTML;
        svgTag = svgTag.substr(0, svgTag.length - 6 - crossword.innerHTML.length);
        svgTag = svgTag.replaceAll('<', "&lt;");
        svgTag = svgTag.replaceAll('" ', "&quot;<br>&nbsp;");
        svgTag = svgTag.replaceAll('"', "&quot;");
        document.getElementById('svgHTML').innerHTML = svgTag;
      }

      function attr2Input(id) {
        var val = crossword.getAttributeNS('', id);
        if (!val) {
          val = '';
        }
        document.getElementById(id).value = val;
      }

      function input2Attr(id) {
        var val = document.getElementById(id).value;
        if (val.length == 0) {
          crossword.removeAttributeNS('', id);
        }
        else {
          crossword.setAttributeNS('', id, document.getElementById(id).value);
        }
      }

      function quick(btn) {
        var val = btn.innerText;
        if (val.startsWith('unset')) {
          val = '';
        }
        var input = btn.parentNode.parentNode.getElementsByTagName('input')[0];
        input.value = val;
        update();
      }
      function clearEdges() {
        clearAllStraightEdges('crossword');
      }
    </script>
    <style>
      #crossword {
        user-select: none; 
        -webkit-user-select: none; /* Safari */        
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* IE10+/Edge */
      }
      #border {
        stroke: black;
        stroke-width: 1.5px;
        fill: none;
      }
      .vertex-g text {
        transform: translate(24px, 32px);
        font-size: 18pt;
        text-anchor: middle;
        cursor: pointer;
      }
      .vertex {
        fill: none;
        width: 48px;
        height: 48px;
        stroke: black;
        stroke-width: 0.5px;
        stroke-dasharray: 2 4;
      }
      input {
        width: 5ch;
      }
    </style>
  </head>
  <body onload="init();">
    <div id="pageBody">
      <p class="flavor">
        A sample word search. Pick the versatility that makes sense for your puzzle.
      </p>

      <svg id="crossword" width="336px" height="336px" class="word-select-area" data-max-points="30" data-hover-range="30" data-angle-constraints="90" data-show-open-drag="true" data-can-cross-self="true">
        <g id="word-select-container" class="word-select-container"></g>
        <g transform="translate(48 48)">
          <rect id="border" width="240" height="240"></rect>
          <g transform="translate(0 0)">
            <g class="vertex-g" transform="translate(0 0)"><rect class="vertex"></rect><text>P</text></g>
            <g class="vertex-g" transform="translate(48 0)"><rect class="vertex"></rect><text>I</text></g>
            <g class="vertex-g" transform="translate(96 0)"><rect class="vertex"></rect><text>N</text></g>
            <g class="vertex-g" transform="translate(144 0)"><rect class="vertex"></rect><text>E</text></g>
            <g class="vertex-g" transform="translate(192 0)"><rect class="vertex"></rect><text>A</text></g>
          </g>
          <g transform="translate(0 48)">
            <g class="vertex-g" transform="translate(0 0)"><rect class="vertex"></rect><text>A</text></g>
            <g class="vertex-g" transform="translate(48 0)"><rect class="vertex"></rect><text>L</text></g>
            <g class="vertex-g" transform="translate(96 0)"><rect class="vertex"></rect><text>O</text></g>
            <g class="vertex-g" transform="translate(144 0)"><rect class="vertex"></rect><text>C</text></g>
            <g class="vertex-g" transform="translate(192 0)"><rect class="vertex"></rect><text>P</text></g>
          </g>
          <g transform="translate(0 96)">
            <g class="vertex-g" transform="translate(0 0)"><rect class="vertex"></rect><text>L</text></g>
            <g class="vertex-g" transform="translate(48 0)"><rect class="vertex"></rect><text>W</text></g>
            <g class="vertex-g" transform="translate(96 0)"><rect class="vertex"></rect><text>N</text></g>
            <g class="vertex-g" transform="translate(144 0)"><rect class="vertex"></rect><text>E</text></g>
            <g class="vertex-g" transform="translate(192 0)"><rect class="vertex"></rect><text>P</text></g>
          </g>
          <g transform="translate(0 144)">
            <g class="vertex-g" transform="translate(0 0)"><rect class="vertex"></rect><text>E</text></g>
            <g class="vertex-g" transform="translate(48 0)"><rect class="vertex"></rect><text>S</text></g>
            <g class="vertex-g" transform="translate(96 0)"><rect class="vertex"></rect><text>T</text></g>
            <g class="vertex-g" transform="translate(144 0)"><rect class="vertex"></rect><text>U</text></g>
            <g class="vertex-g" transform="translate(192 0)"><rect class="vertex"></rect><text>L</text></g>
          </g>
          <g transform="translate(0 192)">
            <g class="vertex-g" transform="translate(0 0)"><rect class="vertex"></rect><text>C</text></g>
            <g class="vertex-g" transform="translate(48 0)"><rect class="vertex"></rect><text>U</text></g>
            <g class="vertex-g" transform="translate(96 0)"><rect class="vertex"></rect><text>A</text></g>
            <g class="vertex-g" transform="translate(144 0)"><rect class="vertex"></rect><text>S</text></g>
            <g class="vertex-g" transform="translate(192 0)"><rect class="vertex"></rect><text>E</text></g>
          </g>
        </g>
      </svg>
      <ul style="position: absolute; right:3in; top:1in;">
        <li>Pine</li>
        <li>Apple</li>
        <li>Pineapple</li>
        <li>Sauces</li>
        <li>Applesauce</li>
        <li>Pinecone</li>
        <li>Paws</li>
        <li>Wall</li>
        <li>Walnuts</li>
      </ul>
      <div style="width:336px; text-align: center;">
        <button onclick="clearEdges()">Clear Selection</button>
      </div>

      <table style="margin-top: 0.25in;">
        <tr><th colspan="2">Update any fields</th></tr>
        <tr>
          <td>data-max-points</td>
          <td><input id="data-max-points" type='text' onkeyup="update()"></td>
          <td>
            <button onclick="quick(this)">2</button>
            <button onclick="quick(this)">5</button>
            <button onclick="quick(this)">100</button>
            <button onclick="quick(this)">unset = 2</button>
          </td>
        </tr>
        <tr>
          <td>data-hover-range</td>
          <td><input id="data-hover-range" type='text' onkeyup="update()"></td>
          <td>
            <button onclick="quick(this)">30</button>
            <button onclick="quick(this)">10</button>
            <button onclick="quick(this)">60</button>
            <button onclick="quick(this)">unset = <i>max</i></button>
          </td>
        </tr>
        <tr>
          <td>data-angle-constraints</td>
          <td><input id="data-angle-constraints" type='text' onkeyup="update()"></td>
          <td>
            <button onclick="quick(this)">45</button>
            <button onclick="quick(this)">90</button>
            <button onclick="quick(this)">1</button>
            <button onclick="quick(this)">unset = <i>any</i></button>
          </td>
        </tr>
        <tr>
          <td>data-show-open-drag</td>
          <td><input id="data-show-open-drag" type='text' onkeyup="update()"></td>
          <td>
            <button onclick="quick(this)">true</button>
            <button onclick="quick(this)">false</button>
            <button onclick="quick(this)">unset = <i>false</i></button>
          </td>
        </tr>
        <tr>
          <td>data-can-cross-self</td>
          <td><input id="data-can-cross-self" type='text' onkeyup="update()"></td>
          <td>
            <button onclick="quick(this)">true</button>
            <button onclick="quick(this)">false</button>
            <button onclick="quick(this)">unset = <i>false</i></button>
          </td>
        </tr>
        <tr>
          <td>word-select-container</td>
          <td><input id="toggle-word-select-container" type='checkbox' onchange="update()"></td>
          <td>exists</td>
        </tr>
      </table>

      <p>
        <span id="svgHTML" style="display: inline-block; border: solid 2px blue; padding:0.1in">
        </span>
      </p>
    </div>
  </body>
</html>
