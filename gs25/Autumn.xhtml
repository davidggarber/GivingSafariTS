<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="UTF-8" />
    <script> var exports = {}; </script>
    <script src="../js/kit25.js" />
    <script src="V/atm.js" />
    <script>
      const boiler = {
        safaris: puzzleSafari22,
        safari: 'ps22',
        title: 'Autumn',
        author: 'Rorke Haining',
        copyright: '2022',
        abilities: {
          textInput: 'nearest',
          scratchPad: true,
          dragDrop: 'svg',
        },
        reactiveBuilder: 'pageBody',
        lookup: {
          ground: [
            'PUMWE',
            'PKINC',
            'RVBOM',
            'CEMNG',
            'OGBER'
          ],
          leaves: [
            ['.KO','.RE','VY.'],
            ['L.','AT','SG','EI','UB'],
            ['AM..','E...','OI..','.ENG'],
            ['SHO.','CNOE'],
            ['RERO','WI..'],
            ['.IK..','.EAF.','NA...','.ZE..','..LEW'],
            ['..HEA','LANS.'],
            ['TS..','.ERP','..ID','.RAN']
          ]
        },
      };

      // <![CDATA[
      function flipLeaf(id) {
        const leaf = document.getElementById(id);
        const f = leaf.getElementsByClassName('flippable');
        if (f.length > 0) {
          toggleClass(f[0], 'flipped', false);
        }
      }

      // ]]>
    </script>
    <style>
      #Local {
        #covers {
          position: absolute;
          left: 2.5in;
          top: 2in;
          pointer-events: none;

          text-anchor: middle;
          user-select: none;
          -moz-user-select: -moz-none;
          -khtml-user-select: none;
          -webkit-user-select: none;
          -o-user-select: none;
        }
        #covers li {
          line-height: 20pt;
        }
        #borders {
          stroke: black;
          stroke-width: 1px;
          fill: none;
        }
        #floor rect {
          stroke: black;
          stroke-width: 1px;
          xfill: #ffffff99;
        }
        #floor {
          font-family: 'Lucida Console', monospace;
          font-size: 14pt;
          fill: black;
          text-anchor: middle;

          user-select: none;
          -moz-user-select: -moz-none;
          -khtml-user-select: none;
          -webkit-user-select: none;
          -o-user-select: none;
        }
        .leaf rect {
          stroke: #666;
          stroke-width: 1px;
        }
        .leaf text {
          text-anchor: middle;
          font-family: 'Lucida Console', monospace;
          font-size: 24pt;
          fill: black;

          user-select: none;
          -moz-user-select: -moz-none;
          -khtml-user-select: none;
          -webkit-user-select: none;
          -o-user-select: none;
        }
        #leaf1 rect { fill: #ff5b00dd; }
        #leaf2 rect { fill: #ecc735dd; }
        #leaf3 rect { fill: #a63131dd; }
        #leaf4 rect { fill: #ffe400dd; }
        #leaf5 rect { fill: #fec608dd; }
        #leaf6 rect { fill: #e55f54dd; }
        #leaf7 rect { fill: #ffc000dd; }
        #leaf8 rect { fill: #ea8037dd; }
        .leaf .flipped {
          transform: scale(-1,1);
        }
        .drop-zone {
          fill: transparent;
        }
        .drop-zone.show {
          stroke: red;
          stroke-width: 2px;
        }
      }
    </style>
  </head>
  <body id="Local">
    <div id="pageBody">
      <p class="flavor">
        The parks in Longview are gorgeous in autumn.
        One by one, the leaves come down, drifting gently in the wind, rotating, flipping, then covering part of the ground below.
      </p>

      <ol id="covers">
        <li>Cover a fall squash</li>        
        <li>Cover a fall month</li>
        <li>Cover a fall dance</li>
        <li>Cover a fall color</li>
        <li>Cover a fall character</li>
        <li>Cover a fall garment</li>
        <li>Cover a fall bug</li>
        <li>Cover a fall holiday</li>
      </ol>

      <svg id="svg" width="720" height="830">
        <rect x="0" y="0" width="720" height="830" fill="transparent" />

        <use template="leaf-source" name="leaf1" tx="100" ty="100" rot="0" width="280" height="326" flip="flipped" />
        <use template="leaf-source" name="leaf2" tx="350" ty="80" rot="-100" width="480" height="259" flip="flipped" />
        <use template="leaf-source" name="leaf3" tx="600" ty="120" rot="-95" width="350" height="350" flip="" />
        <use template="leaf-source" name="leaf4" tx="560" ty="280" rot="10" width="420" height="166" flip="" />
        <use template="leaf-source" name="leaf5" tx="120" ty="260" rot="-165" width="440" height="190" flip="" />
        <use template="leaf-source" name="leaf6" tx="100" ty="430" rot="120" width="398" height="540" flip="" />
        <use template="leaf-source" name="leaf7" tx="330" ty="430" rot="10" width="400" height="225" flip="" />
        <use template="leaf-source" name="leaf8" tx="610" ty="450" rot="-155" width="480" height="400" flip="" />

        <g transform="translate(232,532)">
          <g id="borders">
            <rect x="-32" y="-32" width="320" height="320" />
          </g>
          <g id="floor">
            <for each="row" in="{ground}">
              <for char="ch" in="{row}">
                <g transform="translate({ch#*64}, {row#*64})" class="drop-target">
                  <rect x="-32" y="-32" width="64" height="64" class="drop-zone" />
                  <text y="8">{ch}</text>
                </g>
              </for>
            </for>
          </g>
        </g>
        <g id="drag-layer">
          <use template="leaf-layout" name="leaf1" layout="{leaves.0}" width="3" height="3" flip="flipped" />
          <use template="leaf-layout" name="leaf2" layout="{leaves.1}" width="2" height="5" flip="flipped" />
          <use template="leaf-layout" name="leaf3" layout="{leaves.2}" width="4" height="4" flip="" />
          <use template="leaf-layout" name="leaf4" layout="{leaves.3}" width="4" height="2" flip="" />
          <use template="leaf-layout" name="leaf5" layout="{leaves.4}" width="4" height="2" flip="flipped" />
          <use template="leaf-layout" name="leaf6" layout="{leaves.5}" width="5" height="5" flip="flipped" />
          <use template="leaf-layout" name="leaf7" layout="{leaves.6}" width="5" height="2" flip="flipped" />
          <use template="leaf-layout" name="leaf8" layout="{leaves.7}" width="4" height="4" flip="" />
        </g>
      </svg>

      <use template='finalAnswer' left="1.9in" width="4in" />

    </div>

    <template id="leaf-source">
      <g id="{name}-source" transform="translate({tx},{ty}) scale(0.5) rotate({rot})" class="drag-source">
        <image href="Autumn/{name}.png" x="{width/-2}" y="{height/-2}" width="{width}" height="{height}" transform="rotate({-rot})" />
      </g>
    </template>

    <template id="leaf-layout">
      <g class="transform-copy" transform-copy="{name}-source">
        <g id="{name}" class="moveable leaf flipped2" onclick="flipLeaf('{name}')">
          <g class="flippable {flip}">
            <for each="row" in="{layout}">
              <for char="ch" in="{row}">
                <if test="{ch}" ne=".">
                  <g transform="translate({-32*width + ch#*64 + 32}, {-32*height + row#*64 + 32})">
                    <rect x="-32" y="-32" width="64" height="64" class="drag-handle" />
                    <text y="8">{ch}</text>
                  </g>
                </if>
              </for>
            </for>
          </g>
        </g>
      </g>
    </template>

  </body>
</html>
